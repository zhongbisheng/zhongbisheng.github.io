<!DOCTYPE html>
<html>
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="Wendell&#39;s blog">
  <meta name="keyword" content="hexo-theme, vuejs">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      面向对象设计模式（二）：创建型设计模式 | Wendell&#39;s Blog
    
  </title>
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://oindk07nf.qnssl.com/atom-one-dark.css" media="screen" type="text/css">
  <link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/gitment.css">
  <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdn.bootcss.com/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>
  <script src="/js/qrious.js"></script>
<script src="/js/gitment.js"></script>
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


</head>
<div class="wechat-share">
  <img src="/css/images/logo.png">
</div>

  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>Wendell's Blog</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>面向对象设计模式（二）：创建型设计模式</h2>
  <p class="post-date">2018-09-16</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><p>继上一篇的<a href="https://www.zhongbisheng.com/2018/09/15/面向对象设计模式（一）：六大设计原则/" target="_blank" rel="noopener">面向对象设计模式（一）：六大设计原则</a>，本篇是面向对象设计的第二部分：面向对象设计的设计模式的第一篇文章。</p>
<p>最开始说一下什么是设计模式。关于设计模式的概念，有很多不同的版本，在这里说一下我个人比较赞同的一个说法：</p>
<blockquote>
<p>设计模式用于在特定的条件下为一些重复出现的软件设计问题提供合理的、有效的解决方案。</p>
</blockquote>
<p>去掉一些定语的修饰，这句话精简为：</p>
<blockquote>
<p>设计模式为问题提供方案。</p>
</blockquote>
<p>简单来看，设计模式其实就是针对某些问题的一些方案。在软件开发中，即使很多人在用不同的语言去开发不同的业务，但是很多时候这些人遇到的问题抽象出来都是相似的。一些卓越的开发者将一些常出现的问题和对应的解决方案汇总起来，总结出了这些设计模式。</p>
<p>因此掌握了这些设计模式，可以让我们更好地去解决开发过程中遇到的一些常见问题。而且对这些问题的解决方案的掌握程度越好，我们就越能够打破语言本身的限制去解决问题，也就是增强 “软件开发的内功”。</p>
<p>介绍设计模式最著名的一本书莫属《设计模式 可复用面向对象软件的基础》这本书，书中共介绍了23中设计模式，而这些设计模式分为三大类：</p>
<ul>
<li><strong>创建型</strong>设计模式：侧重于对象的创建；</li>
<li><strong>结构型</strong>设计模式：侧重于接口的设计和系统的结构；</li>
<li><strong>行为型</strong>设计模式：侧重于类或对象的行为。</li>
</ul>
<p>而本篇作为该系列的第一篇，讲解的是设计模式中的6种创建型设计模式：</p>
<ol>
<li>简单工厂模式（Simple Factory Pattern）</li>
<li>工厂方法模式（Factory Method Pattern）</li>
<li>抽象工厂模式（Abstract Factory Pattern）</li>
<li>单例模式（Singleton Pattern）</li>
<li>生成器模式（Builder Pattern）</li>
<li>原型模式（Prototype Pattern）</li>
</ol>
<blockquote>
<p>注意：简单工厂模式不是 GoF 总结出来的23种设计模式之一，不存在于《设计模式 可复用面向对象软件的基础》这本书中。</p>
</blockquote>
<p>在面向对象设计中，类与对象几乎是构成所有系统的基本元素，因此我认为学好了创建型模式才是学会设计系统的第一步：因为你应该知道如何去创建一些特定性质的对象，这才是设计好的系统的开始。</p>
<p>在讲解这6个设计模式之前先说一下该系列文章的讲解方式：</p>
<p>从更多维度来理解一件事物有助于更深刻地理解它，因此每个设计模式我都会从以下这几点来讲解：</p>
<ul>
<li>定义</li>
<li>适用场景</li>
<li>成员与类图</li>
<li>代码示例</li>
<li>优点</li>
<li>缺点</li>
<li>iOS SDK 中的应用</li>
</ul>
<blockquote>
<p>最后一项：”iOS SDK 和 JDK中的应用”讲解的是该设计模式在 Objective-C 和 java 语言（JDK）中的应用。</p>
</blockquote>
<p>首先我们看一下简单工厂模式：</p>
<h1 id="一、简单工厂（Simple-Factory）"><a href="#一、简单工厂（Simple-Factory）" class="headerlink" title="一、简单工厂（Simple Factory）"></a>一、简单工厂（Simple Factory）</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p>简单工厂模式：专门定义一个类（工厂类）来负责创建其他类的实例。可以根据创建方法的参数来返回不同类的实例，被创建的实例通常都具有共同的父类。</p>
</blockquote>
<p>简单工厂模式又称为静态工厂方法（Static Factory Method）模式，它属于类创建型模式。</p>
<h2 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h2><p>如果我们希望将一些为数不多的类似的对象的创建和他们的创建细节分离开，也不需要知道对象的具体类型，可以使用简单工厂模式。</p>
<p>举个形象点的例子：在前端开发中，常常会使用外观各式各样的按钮，比如有的按钮有圆角，有的按钮有阴影，有的按钮有边框，有的按钮无边框等等。但是因为同一种样式的按钮可以出现在项目的很多地方，所以如果在每个地方都把创建按钮的逻辑写一遍的话显然是会造成代码的重复（而且由于业务的原因有的按钮的创建逻辑可能比较复杂，代码量大）。</p>
<p>那么为了避免重复代码的产生，我们可以将这些创建按钮的逻辑都放在一个 “工厂” 里面，让这个工厂来根据你的需求（传入的参数）来创建对应的按钮并返回给你。这样一来，同样类型的按钮在多个地方使用的时候，就可以只给这个工厂传入其对应的参数并拿到返回的按钮即可。</p>
<p>下面来看一下简单工厂模式的成员和类图。</p>
<h2 id="成员与类图"><a href="#成员与类图" class="headerlink" title="成员与类图"></a>成员与类图</h2><p>简单工厂模式的结构比较简单，一共只有三个成员：</p>
<ul>
<li>工厂（Factory）：负责实现创建所有产品实例的逻辑；</li>
<li>抽象产品（Product）：工厂所创建的所有产品对象的父类，负责声明所有产品实例所共有的公共接口；</li>
<li>具体产品（Concrete Product）：工厂所创建的所有产品对象类，它以自己的方式来实现其共同父类声明的接口。</li>
</ul>
<p>下面通过类图来看一下各个成员之间的关系：</p>
<p><img src="https://raw.githubusercontent.com/zhongbisheng/blog_image/master/20190219201218.jpg" alt=""></p>
<blockquote>
<p>从类图中可以看出，工厂类提供一个静态方法：通过传入的类型参数来制造其对应的产品。</p>
<p>简单工厂就做了一件事，把 <strong>Client 要做的创建工作，挪到了另一个类里</strong>。</p>
</blockquote>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><p>举一个店铺售卖不同品牌手机的例子：店铺，即客户端类，向手机工厂购进手机售卖。</p>
<p>该场景可以使用简单工厂的角色来设计：</p>
<ul>
<li>抽象产品：<strong>Phone</strong>，是所有具体产品类的父类，提供一个公共接口 <code>packaging</code>，表示手机装箱并送到店铺；</li>
<li>具体产品：不同品牌的手机，iPhone手机类（<strong>IPhone</strong>），小米手机类（<strong>MIPhone</strong>），华为手机类（<strong>HWPhone</strong>）；</li>
<li>工厂：<strong>PhoneFactory</strong> 根据不同的参数来创建不同的手机；</li>
<li>客户端类：店铺类 <strong>Store</strong> 负责售卖手机。</li>
</ul>
<p>下面来看一下各个类的具体实现：</p>
<p>抽象产品类 <strong>Phone</strong>：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== Phone.h ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Phone</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// package to store</span></span><br><span class="line">- (<span class="keyword">void</span>)packaging;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>具体产品类 <strong>IPhone</strong>：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== IPhone.h ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">IPhone</span> : <span class="title">Phone</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//================== IPhone.m ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">IPhone</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)packaging &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"IPhone has been packaged"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>具体产品类 <strong>MIPhone</strong>：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== MIPhone.h ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MIPhone</span> : <span class="title">Phone</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//================== MIPhone.m ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MIPhone</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)packaging &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"MIPhone has been packaged"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>具体产品类 <strong>HWPhone</strong>：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== HWPhone.h ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">HWPhone</span> : <span class="title">Phone</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//================== HWPhone.m ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">HWPhone</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)packaging &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"HUAWEI Phone has been packaged"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>以上是抽象产品类以及它的三个子类，下面看一下工厂类 <strong>PhoneFactory</strong>：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== PhoneFactory.h ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PhoneFactory</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">+ (Phone *)createPhoneWithTag:(<span class="built_in">NSString</span> *)tag;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//================== PhoneFactory.m ==================</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"IPhone.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MIPhone.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"HWPhone.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">PhoneFactory</span></span></span><br><span class="line"></span><br><span class="line">+ (Phone *)createPhoneWithTag:(<span class="built_in">NSString</span> *)tag &#123;</span><br><span class="line">    <span class="keyword">if</span> ([tag isEqualToString:<span class="string">@"i"</span>]) &#123;</span><br><span class="line">        IPhone *iphone = [[IPhone alloc] init];</span><br><span class="line">        <span class="keyword">return</span> iphone;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> ([tag isEqualToString:<span class="string">@"MI"</span>])&#123;</span><br><span class="line">        MIPhone *miPhone = [[MIPhone alloc] init];</span><br><span class="line">        <span class="keyword">return</span> miPhone;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> ([tag isEqualToString:<span class="string">@"HW"</span>])&#123;</span><br><span class="line">        HWPhone *hwPhone = [[HWPhone alloc] init];</span><br><span class="line">        <span class="keyword">return</span> hwPhone;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>工厂类向外部（客户端）提供了一个创造手机的接口 <code>createPhoneWithTag:</code>，根据传入参数的不同可以返回不同的具体产品类。因此<strong>客户端只需要知道它所需要的产品所对应的参数即可获得对应的产品了</strong>。</p>
</blockquote>
<p>在本例中，我们声明了店铺类 <strong>Store</strong> 为客户端类：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== Store.h ==================</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Phone.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Store</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)sellPhone:(Phone *)phone;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//================== Store.m ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Store</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)sellPhone:(Phone *)phone &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Store begins to sell phone:%@"</span>,[phone <span class="keyword">class</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>客户端类声明了一个售卖手机的接口 <code>sellPhone:</code>，表示它可以售卖作为参数所传入的手机。</p>
</blockquote>
<p>最后我们用代码模拟一下这个实际场景：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== Using by client ==================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//1. A phone store  wants to sell iPhone</span></span><br><span class="line">Store *phoneStore = [[Store alloc] init];</span><br><span class="line">    </span><br><span class="line"><span class="comment">//2. create phone</span></span><br><span class="line">Phone *iPhone = [PhoneFactory  createPhoneWithTag:<span class="string">@"i"</span>];</span><br><span class="line">    </span><br><span class="line"><span class="comment">//3. package phone to store</span></span><br><span class="line">[iphone packaging];</span><br><span class="line">    </span><br><span class="line"><span class="comment">//4. store sells phone after receving it</span></span><br><span class="line">[phoneStore sellPhone:iphone];</span><br></pre></td></tr></table></figure>
<p>上面代码的解读：</p>
<ol>
<li>最开始实例化一个商店，商店打算卖苹果手机；</li>
<li>商店委托工厂给他制作一台iPhone手机，传入对应的参数 <strong>i</strong>；</li>
<li>手机生产好以后打包送到商店；</li>
<li>商店售卖手机。</li>
</ol>
<p>在这里我们需要注意的是：商店从工厂拿到手机不需要了解手机制作过程，只需要知道它要工厂做的是手机（只知道 <strong>Phone</strong> 类即可），和需要给工厂类传入它所需手机所对应的参数即可（这里的 iPhone 手机对应的参数就是 <strong>i</strong>）。</p>
<p>下面我们看一下该例子对应的 UML 类图，可以更直观地看一下各个成员之间的关系：</p>
<p><img src="https://raw.githubusercontent.com/zhongbisheng/blog_image/master/20190218222617.jpg" alt=""></p>
<h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><ul>
<li><p>客户端只需要给工厂类传入一个正确的（约定好的）参数，就可以获取你所需要的对象，而不需要知道其创建细节，一定程度上减少系统的耦合；</p>
</li>
<li><p>客户端无须知道所创建的具体产品类的类名，只需要知道具体产品类所对应的参数即可，减少开发者的记忆成本；</p>
</li>
<li><strong>Factory</strong> 代替了 <strong>Client</strong> 对具体 <strong>Product</strong> 的依赖，那么当需求变化的时候，我们不再需要改动调用方了。</li>
</ul>
<h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><ul>
<li>如果业务上添加新产品的话，就需要修改工厂类原有的判断逻辑，这其实是违背了开闭原则的；</li>
<li>在产品类型较多时，有可能造成工厂逻辑过于复杂，所以简单工厂模式比较适合产品种类比较少而且增多的概率很低的情况。</li>
</ul>
<p>为了解决这些问题，我们引入另一个模式：工厂模式。</p>
<h2 id="iOS-SDK-中的应用"><a href="#iOS-SDK-中的应用" class="headerlink" title="iOS SDK 中的应用"></a>iOS SDK 中的应用</h2><p>Objective-C 中的类族就是简单工厂设计模式的一个应用。如果给 <strong>NSNumber</strong> 的工厂方法传入不同类型的数据，则会返回不同数据所对应的 <strong>NSNumber</strong> 的子类。</p>
<h1 id="二、工厂方法（Factory-Method-）"><a href="#二、工厂方法（Factory-Method-）" class="headerlink" title="二、工厂方法（Factory Method ）"></a>二、工厂方法（Factory Method ）</h1><h2 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p>官方定义：定义一个创建对象的接口，让其子类自己决定实例化哪一个工厂类，工厂模式使其创建过程延迟到子类进行。</p>
</blockquote>
<p>工厂方法模式又称为工厂模式，工厂父类负责定义创建产品对象的公共接口，而工厂子类则负责生产具体的产品对象，即通过不同的工厂子类来创建不同的产品对象。</p>
<h2 id="适用场景-1"><a href="#适用场景-1" class="headerlink" title="适用场景"></a>适用场景</h2><p>工厂方法模式的适用场景与简单工厂类似，都是创建数据和行为比较类似的对象。但是和简单工厂不同的是：在工厂方法模式中，因为创建对象的责任移交给了抽象工厂的子类，因此客户端需要知道其所需产品所对应的工厂子类，而不是简单工厂中的参数。</p>
<p>下面我们看一下工厂方法模式的成员和类图。</p>
<h2 id="成员与类图-1"><a href="#成员与类图-1" class="headerlink" title="成员与类图"></a>成员与类图</h2><p>工厂方法模式包含四个成员：</p>
<ol>
<li>抽象工厂（Abstract Factory）：负责声明具体工厂的创建产品的接口；</li>
<li>具体工厂（Concrete Factory）：负责创建产品；</li>
<li>抽象产品（Abstract Product）：是工厂所创建的所有产品对象的父类，负责声明所有产品实例所共有的公共接口；</li>
<li>具体产品（Concrete Product）：是工厂所创建的所有产品对象类，它以自己的方式来实现其共同父类声明的接口。</li>
</ol>
<p>下面通过类图来看一下各个成员之间的关系：</p>
<p><img src="https://raw.githubusercontent.com/zhongbisheng/blog_image/master/20190219205436.jpg" alt=""></p>
<p>从类图中我们可以看到：抽象工厂负责定义具体工厂必须实现的接口，而创建产品对象的任务则交给具体工厂，由特定的子工厂来创建其对应的产品。</p>
<p>这使得工厂方法模式可以允许系统在不修改原有工厂的情况下引进新产品：只需要创建新产品类和其所对应的工厂类即可。</p>
<h2 id="代码示例-1"><a href="#代码示例-1" class="headerlink" title="代码示例"></a>代码示例</h2><p>同样也是模拟上面的简单工厂例子中的场景（手机商店卖手机），但是由于这次是由工厂方法模式来实现的，因此在代码设计上会有变化。</p>
<p>与简单工厂模式不同的是：简单工厂模式里面只有一个工厂，而工厂方法里有一个抽象工厂和继承于它的具体工厂。</p>
<p>下面我们用代码来具体来看一下工厂类（抽象工厂和具体工厂）的设计：</p>
<p><strong>PhoneFactory</strong>：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== PhoneFactory.h ==================</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Phone.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PhoneFactory</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">- (Phone *)createPhone;</span><br><span class="line">- (Phone *)createPhoneWithType:(<span class="built_in">NSUInteger</span>)type;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//================== PhoneFactory.m ==================</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"IPhoneFactory.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MIPhoneFactory.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"HWPhoneFactory.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">PhoneFactory</span></span></span><br><span class="line"></span><br><span class="line">- (Phone *)createPhone &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (Phone *)createPhoneWithType:(<span class="built_in">NSUInteger</span>)type &#123;</span><br><span class="line">    <span class="keyword">if</span> (type == <span class="number">0</span>) &#123;</span><br><span class="line">        IPhoneFactory *iPhoneFactory = [[IPhoneFactory alloc] init];</span><br><span class="line">        <span class="keyword">return</span> [iPhoneFactory  createPhone];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type == <span class="number">1</span>) &#123;</span><br><span class="line">        MIPhoneFactory *miPhoneFactory = [[MIPhoneFactory alloc] init];</span><br><span class="line">        <span class="keyword">return</span> [miPhoneFactory  createPhone];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        HWPhoneFactory *hwPhoneFactory = [[HWPhoneFactory alloc] init];</span><br><span class="line">        <span class="keyword">return</span> [hwPhoneFactory  createPhone];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>抽象工厂类给具体工厂提供了生产手机的接口，因此不同的具体工厂可以按照自己的方式来生产手机。</p>
</blockquote>
<p><strong>IPhoneFactory</strong>：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== IPhoneFactory.m ==================</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"IPhone.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">IPhoneFactory</span></span></span><br><span class="line"></span><br><span class="line">- (Phone *)createPhone &#123;</span><br><span class="line">    IPhone *iphone = [[IPhone alloc] init];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"iPhone has been created"</span>);</span><br><span class="line">    <span class="keyword">return</span> iphone;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><strong>MIPhoneFactory</strong>:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== MIPhoneFactory.m ==================</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MIPhone.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MIPhoneFactory</span></span></span><br><span class="line"></span><br><span class="line">- (Phone *)createPhone &#123;</span><br><span class="line">    MIPhone *miPhone = [[MIPhone alloc] init];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"MIPhone has been created"</span>);</span><br><span class="line">    <span class="keyword">return</span> miPhone;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><strong>HWPhoneFactory</strong>:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== HWPhoneFactory.m ==================</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"HWPhone.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">HWPhoneFactory</span></span></span><br><span class="line"></span><br><span class="line">- (Phone *)createPhone &#123;</span><br><span class="line">    HWPhone *hwPhone = [[HWPhone alloc] init];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"HWPhone has been created"</span>);</span><br><span class="line">    <span class="keyword">return</span> hwPhone;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>以上就是声明的抽象工厂类和具体工厂类。因为生产手机的责任分配给了各个具体工厂类，因此客户端只需要委托所需手机对应的工厂就可以获得其生产的手机了。</p>
<p>下面是客户端 <strong>Store</strong> 的代码实现：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== Store.h ==================</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"PhoneFactory.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Store</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) PhoneFactory *factory;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)sellPhone:(Phone *)phone;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//================== Store.m ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Store</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        _factory = [[PhoneFactory alloc] init];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)sellPhone:(Phone *)phone &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Store begins to sell %@"</span>,[phone <span class="keyword">class</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>模拟使用场景：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Store *store = [[Store alloc] init];</span><br><span class="line">        </span><br><span class="line">Phone *iPhone = [store.factory createPhoneWithType:<span class="number">0</span>];</span><br><span class="line">[iPhone packaging];</span><br><span class="line">[store sellPhone:iPhone];</span><br><span class="line">        </span><br><span class="line">Phone *miPhone = [store.factory createPhoneWithType:<span class="number">1</span>];</span><br><span class="line">[miPhone packaging];</span><br><span class="line">[store sellPhone:miPhone];</span><br><span class="line">        </span><br><span class="line">Phone *hwPhone = [store.factory createPhoneWithType:<span class="number">2</span>];</span><br><span class="line">[hwPhone packaging];</span><br><span class="line">[store sellPhone:hwPhone];</span><br></pre></td></tr></table></figure>
<blockquote>
<p>输出结果：</p>
<p><strong>iPhone has been created</strong></p>
<p><strong>IPhone has been packaged</strong></p>
<p><strong>Store begins to sell IPhone</strong></p>
<p><strong>MIPhone has been created</strong></p>
<p><strong>MIPhone has been packaged</strong></p>
<p><strong>Store begins to sell MIPhone</strong></p>
<p><strong>HWPhone has been created</strong></p>
<p><strong>HUAWEI Phone has been packaged</strong></p>
<p><strong>Store begins to sell HWPhone</strong></p>
</blockquote>
<p>对于工厂方法的实现，有众多不同的解法，比如 <strong>Factory</strong> 只保留一个 <code>createProduct</code> 让子类实现，让 <strong>Client</strong> 来选择生成哪个具体工厂实例；或是引入一个 <strong>FactoryMaker</strong> 的中间层，作为生产工厂的 “简单工厂”。我这里采用的方式是 <strong>Factory</strong> 既作为工厂父类，让具体工厂决定生产生么产品，又作为接口类，让 <strong>Client</strong> 可以通过<a href="https://link.juejin.im/?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FDependency_injection" target="_blank" rel="noopener">依赖注入</a>选择特定工厂。我这样做的目的是，在不引入新的中间层的情况下，最小化 <strong>Client</strong> 的依赖。</p>
<h2 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h2><p>工厂方法在简单工厂的基础上做了两件事：</p>
<ol>
<li>多了一层抽象，把生产产品的工作延迟到子类执行；</li>
<li>把 “选择如何生产产品的工作” 转化为 “选择让哪个具体工厂生产”。</li>
</ol>
<p>工厂方法的贡献在于，这样做虽然不能完美避免对一个if-else的扩展，但是这个扩展规模被极大限制住了（只需要new一个类），用户只需要关心其所需产品对应的具体工厂是哪一个即可，不需要关心产品的创建细节，也不需要知道具体产品类的类名</p>
<h2 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h2><p>当系统中加入新产品时，除了需要提供新的产品类之外，还要提供与其对应的具体工厂类。因此系统中类的个数将成对增加，增加了系统的复杂度。</p>
<p>工厂方法着重点是解决了单一产品线的派生问题。那如果有多个相关产品线呢？</p>
<h1 id="三、抽象工厂（Abstract-Factory）"><a href="#三、抽象工厂（Abstract-Factory）" class="headerlink" title="三、抽象工厂（Abstract Factory）"></a>三、抽象工厂（Abstract Factory）</h1><h2 id="定义-2"><a href="#定义-2" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p>提供一个创建一系列相关或相互依赖对象的接口，而无需指定它们具体的类。</p>
</blockquote>
<h2 id="适用场景-2"><a href="#适用场景-2" class="headerlink" title="适用场景"></a>适用场景</h2><p>有时候我们需要一个工厂可以提供多个产品对象，而不是单一的产品对象。比如系统中有多于一个的产品族，而每次只适用其中某一产品族，属于同一个产品族的产品将在一起使用。</p>
<p>在这里说一下产品族和产品等级结构的概念：</p>
<ul>
<li>产品族：同一工厂生产的不同产品；</li>
<li>产品等级结构：同一类型产品的不同实现</li>
</ul>
<p>用一张图来帮助理解：</p>
<p><img src="https://raw.githubusercontent.com/zhongbisheng/blog_image/master/20190222145432.jpg" alt=""></p>
<p>在上图中：</p>
<ul>
<li>纵向的，不同形状，相同色系的图形属于同一产品族的产品，而同一产品族的产品对应的是同一个工厂；</li>
<li>横向的，同一形状，不同色系的图形属于同一产品等级结构的产品，而同一产品等级结构的产品对应的是同一个工厂方法/</li>
</ul>
<p>下面再举一个例子帮助大家理解：</p>
<p>我们将小米、华为、苹果公司比作抽象工厂方法里的工厂，这三个工厂都有自己生产的手机、平板和电脑。那么小米手机、小米平板和小米电脑属于小米这个工厂的产品族；同样适用于华为工厂和苹果工厂。而小米手机、华为手机和苹果手机则属于同一产品等级结构，平板和电脑也是如此。</p>
<p>结合这个例子对上面的图做一个修改可以更形象地理解抽象工厂方法的设计：</p>
<p><img src="https://raw.githubusercontent.com/zhongbisheng/blog_image/master/20190222150057.jpg" alt=""></p>
<h2 id="成员和类图"><a href="#成员和类图" class="headerlink" title="成员和类图"></a>成员和类图</h2><p>抽象工厂的成员和工厂方法的成员是一样的，只不过抽象工厂方法里的工厂是面向产品族的：</p>
<ol>
<li>抽象工厂（Abstract Factory）：负责声明具体工厂创建产品族内的所有产品的接口；</li>
<li>具体工厂（Concrete Factory）：负责创建产品族内的产品；</li>
<li>抽象产品（Abstract Product）：是工厂所创建的所有产品对象的父类，负责声明所有产品实例所共有的公共接口；</li>
<li>具体产品（Concrete Product）：是工厂所创建的所有产品对象类，它以自己的方式来实现其共同父类声明的接口。</li>
</ol>
<p>下面通过类图来看一下各个成员之间的关系：</p>
<p><img src="https://raw.githubusercontent.com/zhongbisheng/blog_image/master/20190222151947.jpg" alt=""></p>
<p>当我们有两个相关的产品线 <strong>ProductA</strong> 和 <strong>ProductB</strong>，例如手机和电脑，它们派生出 <strong>ProductA1</strong>、<strong>ProductA2</strong> 和 <strong>ProductB1</strong>、<strong>ProductB2</strong>，前者我们由工厂 <strong>ConcreteFactory1</strong> 来制作，后者由 <strong>ConcreteFactory2</strong> 来制作。</p>
<p>对于 <strong>Client</strong> 来说，他只需要知道有一个抽象工厂能同时生产 <strong>ProductA</strong> 和 <strong>ProductB</strong> 就行了，那就是图中的 <strong>Factory</strong>。</p>
<p><strong>重点来了</strong>，这个抽象的 <strong>Factory</strong> 是通过 <strong>“工厂方法”</strong> 模式把构造过程延迟到子类执行的，也就是说，抽象工厂是建立在工厂方法的基础上的模式。</p>
<p>所以抽象工厂，换句话说，就是多个产品线需要绑定在一起，形成一个抽象的综合工厂，由具体的综合工厂来批量实现 “工厂方法” 的一种更 “高级” 的模式。</p>
<h2 id="代码示例-2"><a href="#代码示例-2" class="headerlink" title="代码示例"></a>代码示例</h2><p>由于抽象工厂方法里的工厂是面向产品族的，所以为了贴合抽象工厂的特点，我们将上面的场景做一下调整：商店不仅卖手机，还卖电脑，包括苹果电脑、小米电脑和华为电脑。</p>
<p>如果我们还是套用上面介绍过的工厂方法模式来实现该场景的话，则需要创建三个电脑产品对应的工厂：苹果电脑工厂、小米电脑工厂和华为电脑工厂。这就导致类的个数直线上升，以后如果还增加其他的产品，还需要添加其对应的工厂类，这显然是不够优化的。</p>
<p>仔细看一下这六个产品的特点，我们可以把它们划分在三个产品族里面：</p>
<ol>
<li>苹果产品族：苹果手机、苹果电脑；</li>
<li>小米产品族：小米手机、小米电脑；</li>
<li>华为产品族：华为手机、华为电脑。</li>
</ol>
<p>而抽象方法恰恰是面向产品族设计的，因此该场景适合使用抽象工厂。下面结合代码来看一下该如何设计。</p>
<p>首先引入电脑的基类和各个品牌的电脑类：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== Computer.h ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Computer</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)packaging;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//================== Computer.m ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Computer</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)packaging &#123;</span><br><span class="line">    <span class="comment">// 有子类继承实现</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== MacBookComputer.m ==================</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MacBookComputer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MacBookComputer</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)packaging &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"MacBook Computer has been packaged."</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== MIComputer.m ==================</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MIComputer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MIComputer</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)packaging &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"MI Computer has been packaged."</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== MateBookComputer.m ==================</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MateBookComputer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MateBookComputer</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)packaging &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"MateBook Computer has been packaged."</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>引入电脑相关产品类以后，我们需要重新设计工厂类。因为抽象工厂的工厂是面向产品族的，所以工厂所创建的是同一产品族的产品。下面我们看一下抽象工厂模式的工厂该如何设计：</p>
<p>首先创建所有工厂都需要集成的抽象工厂，它声明了生产同一产品族的所有产品接口：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== Factory.h ==================</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Phone.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Computer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Factory</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">- (Phone *)createPhone;  <span class="comment">// 用于继承</span></span><br><span class="line">- (Computer *)createComputer;  <span class="comment">// 用于继承</span></span><br><span class="line"></span><br><span class="line">- (Phone *)createPhoneWithType:(<span class="built_in">NSUInteger</span>)type;  <span class="comment">// 用于调用</span></span><br><span class="line">- (Computer *)createComputerWithType:(<span class="built_in">NSUInteger</span>)type;  <span class="comment">// 用于调用</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//================== Factory.m ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Factory</span></span></span><br><span class="line"></span><br><span class="line">- (Phone *)createPhone &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (Computer *)createComputer &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (Phone *)createPhoneWithType:(<span class="built_in">NSUInteger</span>)type &#123;</span><br><span class="line">    <span class="keyword">if</span> (type == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> [[[AppleFactory alloc] init] createPhone];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> [[[MIFactory alloc] init] createPhone];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> [[[HWFactory alloc] init] createPhone];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (Computer *)createComputerWithType:(<span class="built_in">NSUInteger</span>)type &#123;</span><br><span class="line">    <span class="keyword">if</span> (type == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> [[[AppleFactory alloc] init] createComputer];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> [[[MIFactory alloc] init] createComputer];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> [[[HWFactory alloc] init] createComputer];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>接着，根据不同的产品族，我们创建不同的具体工厂：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== AppleFactory.m ==================</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"IPhone.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MacBookComputer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AppleFactory</span></span></span><br><span class="line"></span><br><span class="line">- (Phone *)createPhone &#123;</span><br><span class="line">    IPhone *iPhone = [[IPhone alloc] init];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"iPhone has bee created."</span>);</span><br><span class="line">    <span class="keyword">return</span> iPhone;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (Computer *)createComputer &#123;</span><br><span class="line">    MacBookComputer *computer = [[MacBookComputer alloc] init];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"MacBook has been created."</span>);</span><br><span class="line">    <span class="keyword">return</span> computer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== MIFactory.m ==================</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MIPhone.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MIComputer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MIFactory</span></span></span><br><span class="line"></span><br><span class="line">- (Phone *)createPhone &#123;</span><br><span class="line">    MIPhone *phone = [[MIPhone alloc] init];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Mi Phone bas been created."</span>);</span><br><span class="line">    <span class="keyword">return</span> phone;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (Computer *)createComputer &#123;</span><br><span class="line">    MIComputer *computer = [[MIComputer alloc] init];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Mi Computer bas been created."</span>);</span><br><span class="line">    <span class="keyword">return</span> computer;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== HWFactory.m ==================</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"HWPhone.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MateBookComputer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">HWFactory</span></span></span><br><span class="line"></span><br><span class="line">- (Phone *)createPhone &#123;</span><br><span class="line">    HWPhone *phone = [[HWPhone alloc] init];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"HWPhone has been created."</span>);</span><br><span class="line">    <span class="keyword">return</span> phone;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (Computer *)createComputer &#123;</span><br><span class="line">    MateBookComputer *computer = [[MateBookComputer alloc] init];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"MateBook Computer has been created."</span>);</span><br><span class="line">    <span class="keyword">return</span> computer;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>接下来就是 <strong>Store</strong> 类的代码实现：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== Store.h ==================</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Factory.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Store</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Factory *factory;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//================== Store.m ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Store</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        _factory = [[Factory alloc] init];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>下面用代码来模拟一下使用场景：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Store *store = [[Store alloc] init];</span><br><span class="line">[store.factory createPhoneWithType:<span class="number">0</span>];  <span class="comment">// get iPhone</span></span><br><span class="line">[store.factory createPhoneWithType:<span class="number">1</span>];  <span class="comment">// get MiPhone</span></span><br><span class="line">[store.factory createPhoneWithType:<span class="number">2</span>];  <span class="comment">// get HWPhone</span></span><br><span class="line"></span><br><span class="line">[store.factory createComputerWithType:<span class="number">0</span>];  <span class="comment">// get MacBook computer</span></span><br><span class="line">[store.factory createComputerWithType:<span class="number">1</span>];  <span class="comment">// get Mi computer</span></span><br><span class="line">[store.factory createComputerWithType:<span class="number">2</span>];  <span class="comment">// get MateBook computer</span></span><br></pre></td></tr></table></figure>
<p>上面的代码通过给工厂传入不同的参数，可以获得不同品牌的手机或电脑。而今后如果该商店引入了新品牌的产品，比如联想手机、联想电脑，那么我们只需要新增联想手机类、联想电脑类和联想工厂类即可。</p>
<h2 id="优点-2"><a href="#优点-2" class="headerlink" title="优点"></a>优点</h2><p>具体产品在应用层代码隔离，不需要关心产品细节。只需要知道自己需要的产品是属于哪个工厂的即可。当一个产品族中的多个对象被设计成一起工作时，它能够保证客户端始终只使用同一个产品族中的对象。这对一些需要根据当前环境来决定其行为的软件系统来说，是一种非常实用的设计模式。</p>
<h2 id="缺点-2"><a href="#缺点-2" class="headerlink" title="缺点"></a>缺点</h2><ul>
<li>规定了所有可能被创建的产品集合，产品族中扩展新的产品困难，需要修改抽象工厂的接口；</li>
<li>新增产品等级比较困难；</li>
<li>产品等级固定，而产品族不固定，扩展性强的场景。</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>到现在三个工厂模式已经讲完了。在继续讲解下面三个设计模式之前，先简单回顾一下上面讲解的三个工厂模式：</p>
<ol>
<li>简单工厂使用不同的入参来让同一个工厂生产出不同的产品；</li>
<li>工厂方法和抽象工厂需要有特定的工厂类来生产对应的产品。工厂方法着重点是解决单一产品线的派生问题；而抽象工厂则是多条产品线的。</li>
</ol>
<p>大体上看，简单工厂、工厂方法和抽象工厂的复杂程度是逐渐升高的，这些工厂模式并不是割裂的存在，而是一个递进的思想。</p>
<h1 id="四、单例模式（Singleton）"><a href="#四、单例模式（Singleton）" class="headerlink" title="四、单例模式（Singleton）"></a>四、单例模式（Singleton）</h1><h2 id="定义-3"><a href="#定义-3" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p>保证一个类仅有一个实例，并提供一个访问它的全局访问点。</p>
</blockquote>
<h2 id="适用场景-3"><a href="#适用场景-3" class="headerlink" title="适用场景"></a>适用场景</h2><p>系统只需要一个实例对象，客户调用类的单个实例只允许使用一个公共访问点，除了该公共访问点，不能通过其他途径访问该实例。比较典型的例子是音乐播放器、日志系统类等等。</p>
<h2 id="成员与类图-2"><a href="#成员与类图-2" class="headerlink" title="成员与类图"></a>成员与类图</h2><p>单例模式只有一个成员，就是单例类。因为只有一个成员，所以该设计模式的类图比较简单：</p>
<p><img src="https://raw.githubusercontent.com/zhongbisheng/blog_image/master/20190223104642.jpg" alt=""></p>
<blockquote>
<p>一般来说，单例类会给外部提供一个获取单例对象的方法，内部会用静态对象的方式保存这个对象。</p>
</blockquote>
<h2 id="代码示例-3"><a href="#代码示例-3" class="headerlink" title="代码示例"></a>代码示例</h2><p>在这里我们创建一个简单的打印日志或上报日志的日志管理类。</p>
<p>在创建单例时，除了要保证提供唯一实例对象以外，还需注意多线程的问题。下面用代码来看一下。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== LogManager.h ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">LogManager</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">+(<span class="keyword">instancetype</span>)sharedInstance;</span><br><span class="line">- (<span class="keyword">void</span>)resetInstance；</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)printLog:(<span class="built_in">NSString</span> *)logMessage;</span><br><span class="line">- (<span class="keyword">void</span>)uploadLog:(<span class="built_in">NSString</span> *)logMessage;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//================== LogManager.m ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LogManager</span></span></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line"><span class="keyword">static</span> LogManager *sharedInstance = <span class="literal">nil</span>;</span><br><span class="line"></span><br><span class="line">+(<span class="keyword">instancetype</span>)sharedInstance &#123;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">        sharedInstance = [[<span class="keyword">super</span> allocWithZone:<span class="literal">NULL</span>] init] ;</span><br><span class="line">    &#125;) ;</span><br><span class="line">    <span class="keyword">return</span> sharedInstance ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+(<span class="keyword">instancetype</span>)allocWithZone:(<span class="keyword">struct</span> _NSZone *)zone &#123;</span><br><span class="line">    <span class="keyword">return</span> [LogManager sharedInstance] ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">id</span>)copyWithZone:(<span class="keyword">struct</span> _NSZone *)zone &#123;</span><br><span class="line">    <span class="keyword">return</span> [LogManager sharedInstance];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">id</span>)mutableCopyWithZone:(<span class="built_in">NSZone</span> *)zone &#123;</span><br><span class="line">    <span class="keyword">return</span> [LogManager sharedInstance];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)resetInstance &#123;</span><br><span class="line">    onceToken = <span class="number">0</span>;</span><br><span class="line">    sharedInstance = <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)printLog:(<span class="built_in">NSString</span> *)logMessage &#123;</span><br><span class="line">    <span class="comment">//print logMessage</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)uploadLog:(<span class="built_in">NSString</span> *)logMessage &#123;</span><br><span class="line">    <span class="comment">//upload logMessage</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>从上面的代码中可以看到：</p>
<ul>
<li><code>sharedInstance</code> 方法是向外部提供的获取唯一的实例对象的方法，也是该类中的其他可以创建对象的方法都调用的方法。在这个方法内部使用了 <code>dispatch_once</code> 函数来避免多线程访问导致创建多个实例的情况；</li>
<li>为了在 <code>alloc init</code> 初始化方法可以返回同一个实例对象，在 <code>allocWithZone:</code> 方法里面仍然调用了 <code>sharedInstance</code> 方法；</li>
<li>而且为了在 <code>copy</code> 和 <code>mutableCopy</code> 方法也可以返回同一个实例对象，在 <code>copyWithZone:</code> 与 <code>mutableCopyWithZone:</code> 也是调用了 <code>sharedInstance</code> 方法；</li>
<li>此外还提供了清除单例的方法 <code>resetInstance</code>。</li>
</ul>
<p>下面分别用这些接口来验证一下实例的唯一性：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== Using by client ==================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//alloc&amp;init</span></span><br><span class="line">LogManager *manager0 = [[LogManager alloc] init];</span><br><span class="line"></span><br><span class="line"><span class="comment">//sharedInstance</span></span><br><span class="line">LogManager *manager1 = [LogManager sharedInstance];</span><br><span class="line"></span><br><span class="line"><span class="comment">//copy</span></span><br><span class="line">LogManager *manager2 = [manager0 <span class="keyword">copy</span>];</span><br><span class="line">    </span><br><span class="line"><span class="comment">//mutableCopy</span></span><br><span class="line">LogManager *manager3 = [manager1 mutableCopy];</span><br><span class="line">    </span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"\nalloc&amp;init:     %p\nsharedInstance: %p\ncopy:           %p\nmutableCopy:    %p"</span>,manager0,manager1,manager2,manager3);</span><br></pre></td></tr></table></figure>
<p>我们看一下打印出来的四个指针所指向对象的地址：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">alloc&amp;init:     <span class="number">0x60000000f7e0</span></span><br><span class="line">sharedInstance: <span class="number">0x60000000f7e0</span></span><br><span class="line"><span class="keyword">copy</span>:           <span class="number">0x60000000f7e0</span></span><br><span class="line">mutableCopy:    <span class="number">0x60000000f7e0</span></span><br></pre></td></tr></table></figure>
<p>可以看出打印出来的地址都相同，说明都是同一对象，证明了实现方法的正确性。</p>
<h2 id="优点-3"><a href="#优点-3" class="headerlink" title="优点"></a>优点</h2><ul>
<li>提供了对唯一实例的受控访问。因为单例类封装了它的唯一实例，所以它可以严格控制客户怎样以及何时访问它；</li>
<li>因为该类在系统内存中只存在一个对象，所以可以节约系统资源。</li>
</ul>
<h2 id="缺点-3"><a href="#缺点-3" class="headerlink" title="缺点"></a>缺点</h2><ul>
<li>由于单例模式中没有抽象层，因此单例类很难进行扩展；</li>
<li>对于有垃圾回收系统的语言（Java，C#）来说，如果对象长时间不被利用，则可能会被回收。那么如果这个单例持有一些数据的话，在回收后重新实例化时就不复存在了。</li>
</ul>
<h2 id="iOS-SDK-中应用"><a href="#iOS-SDK-中应用" class="headerlink" title="iOS SDK 中应用"></a>iOS SDK 中应用</h2><p>在Objective-C语言中使用单例模式的类有 <strong>NSUserDefaults</strong>（key-value持久化）和 <strong>UIApplication</strong>类（代表应用程序，可以处理一些点击事件等）。</p>
<h1 id="五、生成器模式（Builder）"><a href="#五、生成器模式（Builder）" class="headerlink" title="五、生成器模式（Builder）"></a>五、生成器模式（Builder）</h1><h2 id="定义-4"><a href="#定义-4" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p>也叫建造者模式，它将一个复杂对象的构建与其表示分离，使得同样的构建过程可以创建不同的表示。</p>
</blockquote>
<p>具体点说就是：有些对象的创建流程是一样的，但是因为自身特性的不同，所以在创建他们的时候需要将创建过程和特性的定制分离开来。</p>
<p>下面我们看一下该设计模式的适用场景。</p>
<h2 id="适用场景-4"><a href="#适用场景-4" class="headerlink" title="适用场景"></a>适用场景</h2><p>当创建复杂对象的算法应该独立于该对象的组成部分以及它们的装配方式时比较适合使用生产器模式。</p>
<p>一些复杂的对象，它们拥有多个组成部分（如汽车，它包括车轮、方向盘、发动机等各种部件）。而对于大多数用户而言，无须知道这些部件的装配细节，也几乎不会使用单独某个部件，而是使用一辆完整的汽车。而且这些部件的创建顺序是固定的，或者是需要指定的。</p>
<p>在这种情况下可以通过生成器模式对其进行设计与描述，生成器模式可以将部件和其组装过程分来，一步一步创建一个复杂的对象。</p>
<h2 id="成员与类图-3"><a href="#成员与类图-3" class="headerlink" title="成员与类图"></a>成员与类图</h2><p>建造者模式包含4个成员：</p>
<ol>
<li>抽象建造者（Builder）：定义构造产品的几个公共方法；</li>
<li>具体建造者（ConcreteBuilder）：根据不同的需求来实现抽象建造者定义的公共方法，每一个具体建造者都包含一个产品对象作为它的成员变量；</li>
<li>指挥者（Director）：根据传入的具体建造者来返回其所对应的产品对象；</li>
<li>产品角色（Product）：创建的产品。</li>
</ol>
<p>下面通过类图来看一下各个成员之间的关系：</p>
<p><img src="https://raw.githubusercontent.com/zhongbisheng/blog_image/master/20190223200753.jpg" alt=""></p>
<blockquote>
<p>需要注意的是：</p>
<ul>
<li>Builder 类中的 product 成员变量的关键字为 protected，目的是为了仅让它和它的子类可以访问该成员变量；</li>
<li>Director 类中的 <code>constructProductWithBuilder:(Builder *)builder</code> 方法是通过传入不同的  builder 来构造产品的。而且它的 <code>getProduct()</code> 方法同时也封装了Concrete Builder 类的 <code>getProduct()</code> 方法，目的是为了让客户端直接从 Director 拿到对应的产品（有些资料里面的 Director 类没有封装 Concrete Builder 类的 <code>getProduct()</code> 方法）。</li>
</ul>
</blockquote>
<h2 id="代码示例-4"><a href="#代码示例-4" class="headerlink" title="代码示例"></a>代码示例</h2><p>模拟一个制造手机的场景：手机的组装需要几个固定的零件：CPU、RAM、屏幕和摄像头，而且需要按照 CPU -&gt; RAM -&gt;屏幕 -&gt; 摄像头的顺序来制造。</p>
<p>我们使用建造者模式来实现这个场景：首先不同的手机要匹配不同的 builder，然后在 Director 类里面来定义制造顺序。</p>
<p>首先我们定义手机这个类，它有几个属性：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== Phone.h ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Phone</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *cpu;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *capacity;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *display;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *camera;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>然后我们创建抽象 <strong>Builder</strong> 类：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== Builder.h ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Phone</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Builder</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)createPhone;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)buildCPU;</span><br><span class="line">- (<span class="keyword">void</span>)buildCapacity;</span><br><span class="line">- (<span class="keyword">void</span>)buildDisplay;</span><br><span class="line">- (<span class="keyword">void</span>)buildCamera;</span><br><span class="line"></span><br><span class="line">- (Phone *)obtainPhone;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//================== Builder.m ==================</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Phone.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Builder</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Phone *phone;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Builder</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>抽象 <strong>Builder</strong> 类声明了创建手机各个组件的接口，也提供了返回手机实例的对象。</p>
</blockquote>
<p>接下来我们创建对应不同手机的具体生成者类：</p>
<p>iPhoneXR 手机的 builder：<strong>IPhoneXRBuilder</strong>：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== IPhoneXRBuilder.h ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">IPhoneXRBuilder</span> : <span class="title">Builder</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//================== IPhoneXRBuilder.m ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">IPhoneXRBuilder</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)createPhone &#123;</span><br><span class="line">    _phone = [[Phone alloc] init];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)buildCPU &#123;</span><br><span class="line">    [_phone setCpu:<span class="string">@"A12"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)buildCapacity &#123;</span><br><span class="line">    [_phone setCapacity:<span class="string">@"256"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)buildDisplay &#123;</span><br><span class="line">    [_phone setDisplay:<span class="string">@"6.1"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)buildCamera &#123;</span><br><span class="line">    [_phone setCamera:<span class="string">@"12MP"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (Phone *)obtainPhone &#123;</span><br><span class="line">    <span class="keyword">return</span> _phone;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>小米8手机的 builder：<strong>MI8Builder</strong>：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== MI8Builder.h ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MI8Builder</span> : <span class="title">Builder</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//================== MI8Builder.m ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MI8Builder</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)createPhone &#123;</span><br><span class="line">    _phone = [[Phone alloc] init];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)buildCPU &#123;</span><br><span class="line">    [_phone setCpu:<span class="string">@"Snapdragon 845"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)buildCapacity &#123;</span><br><span class="line">    [_phone setCapacity:<span class="string">@"128"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)buildDisplay &#123;</span><br><span class="line">    [_phone setDisplay:<span class="string">@"6.21"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)buildCamera &#123;</span><br><span class="line">    [_phone setCamera:<span class="string">@"12MP"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (Phone *)obtainPhone &#123;</span><br><span class="line">    <span class="keyword">return</span> _phone;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>从上面两个具体 builder 的代码可以看出，这两个 builder 都按照其对应的手机配置来创建其对应的手机。</p>
</blockquote>
<p>下面来看一下 <strong>Director</strong> 的用法：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== Director.h ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Builder</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Director</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)constructPhoneWithBuilder:(Builder *)builder;</span><br><span class="line">- (Phone *)obtainPhone;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//================== Director.m ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Director</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Builder *builder;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Director</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)constructPhoneWithBuilder:(Builder *)builder &#123;</span><br><span class="line">    <span class="keyword">self</span>.builder = builder;</span><br><span class="line">    </span><br><span class="line">    [_builder buildCPU];</span><br><span class="line">    [_builder buildCapacity];</span><br><span class="line">    [_builder buildDisplay];</span><br><span class="line">    [_builder buildCamera];  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (Phone *)obtainPhone &#123;   </span><br><span class="line">    <span class="keyword">return</span> [_builder obtainPhone];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Director</strong> 类提供了 <code>construct:</code> 方法，需要传入 builder 的实例。该方法里面按照既定的顺序来创建手机。</p>
</blockquote>
<p>最后我们看一下客户端是如何使用具体的 <strong>Builder</strong> 和 <strong>Director</strong> 实例的：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== Using by client ==================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Get iPhoneXR</span></span><br><span class="line"><span class="comment">// 1. A director instance</span></span><br><span class="line">Director *director = [[Director alloc] init];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. A builder instance</span></span><br><span class="line">IPhoneXRBuilder *iphoneXRBuilder = [[IPhoneXRBuilder alloc] init];</span><br><span class="line"><span class="comment">// 3. Construct phone by director</span></span><br><span class="line">[director construct:iphoneXRBuilder];</span><br><span class="line"><span class="comment">// 4. Get phone by builder</span></span><br><span class="line">Phone *iPhoneXR = [iphoneXRBuilder obtainPhone];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"Get new phone iPhoneXR of data: %@"</span>,iPhoneXR);</span><br><span class="line">    </span><br><span class="line"><span class="comment">// Get MI8</span></span><br><span class="line">MI8Builder *mi8Builder = [[MI8Builder alloc] init];</span><br><span class="line">[director construct:mi8Builder];</span><br><span class="line">Phone *mi8 = [mi8Builder obtainPhone];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"Get new phone MI8 of data: %@"</span>,mi8);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>从上面可以看出客户端获取具体产品的过程：</p>
<ol>
<li>首先需要实例化一个 <strong>Director</strong> 实例；</li>
<li>然后根据所需要的产品找出其对应的 builder；</li>
<li>将 builder 传入 director 实例的 <code>construct:</code> 方法；</li>
<li>从 builder 的 <code>obtainPhone</code> 获取手机实例。</li>
</ol>
</blockquote>
<h2 id="优点-4"><a href="#优点-4" class="headerlink" title="优点"></a>优点</h2><ul>
<li>客户端不必知道产品内部组成的细节，将产品本身与产品的创建过程接耦，使得相同的创建过程可以创建不同的产品对象；</li>
<li>每一个具体建造者都相对独立，而与其他的具体建造者无关，因此可以很方便地替换具体建造者或增加新的具体建造者，用户使用不同的具体建造者即可得到不同的产品对象；</li>
<li>增加新的具体建造者无须修改原有类库的代码，指挥者类针对抽象建造者类编程，系统扩展方便，符合 “开闭原则”；</li>
<li>可以更加精细地控制产品的创建过程，将复杂产品的创建步骤分解在不同的方法中，使得创建过程更加清晰，也更方便使用程序来控制创建过程。</li>
</ul>
<h2 id="缺点-4"><a href="#缺点-4" class="headerlink" title="缺点"></a>缺点</h2><ul>
<li>建造者模式所创建的产品一般具有较多的共同点，其组成部分相似，如果产品之间的差异性很大，则不适合使用建造者模式，因此其使用范围受到一定的限制；</li>
<li>如果产品的内部变化复杂，可能会导致需要定义很多具体建造者类来实现这种变化，导致系统变得很庞大。</li>
</ul>
<h1 id="六、原型模式（Prototype）"><a href="#六、原型模式（Prototype）" class="headerlink" title="六、原型模式（Prototype）"></a>六、原型模式（Prototype）</h1><h2 id="定义-5"><a href="#定义-5" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p>使用原型实例指定待创建对象的类型，并且通过复制这个原型来创建新的对象。</p>
</blockquote>
<h2 id="适用场景-5"><a href="#适用场景-5" class="headerlink" title="适用场景"></a>适用场景</h2><ul>
<li>对象层级嵌套比较多，从0到1创建对象的过程比较繁琐时，可以直接通过复制的方式创建新的对象；</li>
<li>当一个类的实例只能有几个不同状态组合中的一种时，我们可以利用已有的对象进行复制来获得。</li>
</ul>
<p>原型模式很简单，你只要实现一个<strong>返回你自己的新对象</strong>的方法即可。</p>
<h2 id="成员与类图-4"><a href="#成员与类图-4" class="headerlink" title="成员与类图"></a>成员与类图</h2><p>原型模式主要包含如下两个角色：</p>
<ol>
<li>抽象原型类（Prototype）：抽象原型类声明克隆自身的接口；</li>
<li>具体原型类（ConcretePrototype）：具体原型类实现克隆的具体操作（克隆数据，状态等）。</li>
</ol>
<p>下面通过类图来看一下各个成员之间的关系：</p>
<p><img src="https://raw.githubusercontent.com/zhongbisheng/blog_image/master/20190223205600.jpg" alt=""></p>
<p>需要注意的是，这里面的 <code>clone()</code> 方法返回的是被复制出来的实例对象。</p>
<h2 id="代码示例-5"><a href="#代码示例-5" class="headerlink" title="代码示例"></a>代码示例</h2><p>模拟一份校招的简历，简历里面有人名、性别、年龄以及学历相关的信息。这里面学历相关的信息又包括学校名称、专业、开始和截止年限的信息。</p>
<p>这里学历相关信息可以使用单独一个对象来做，因此整体的简历对象的结构可以是：</p>
<p>简历对象：</p>
<ul>
<li>人名</li>
<li>性别</li>
<li>年龄</li>
<li>学历<ul>
<li>学校名称</li>
<li>专业</li>
<li>开始年份</li>
<li>结束年份</li>
</ul>
</li>
</ul>
<p>而且因为对于同一学校同一届的同一专业的毕业生来说，学历对象中的信息是相同的，这时候如果需要大量生成这些毕业生的简历的话比较适合使用原型模式。</p>
<p>首先定义学历对象：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== UniversityInfo.h ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UniversityInfo</span> : <span class="title">NSObject</span>&lt;<span class="title">NSCopying</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *universityName;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *startYear;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *endYear;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *major;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)copyWithZone:(<span class="built_in">NSZone</span> *)zone;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//================== UniversityInfo.m ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UniversityInfo</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)copyWithZone:(<span class="built_in">NSZone</span> *)zone &#123;</span><br><span class="line">    UniversityInfo *infoCopy = [[[<span class="keyword">self</span> <span class="keyword">class</span>] allocWithZone:zone] init];</span><br><span class="line">    [infoCopy setUniversityName:[_universityName mutableCopy]];</span><br><span class="line">    [infoCopy setStartYear:[_startYear mutableCopy]];</span><br><span class="line">    [infoCopy setEndYear:[_endYear mutableCopy]];</span><br><span class="line">    [infoCopy setMajor:[_major mutableCopy]];</span><br><span class="line">    <span class="keyword">return</span> infoCopy;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>因为学历对象是支持复制的，因此需要遵从 <strong><em>NSCopying</em></strong> 协议并实现 <code>copyWithZone:</code> 方法。而且支持的是深复制，所以在复制 NSString 的过程中需要使用 <code>mutableCopy</code> 来实现。</p>
</blockquote>
<p>接着我们看一下简历对象：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== Resume.h ==================</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UniversityInfo.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Resume</span> : <span class="title">NSObject</span>&lt;<span class="title">NSCopying</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *gender;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *age;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) UniversityInfo *universityInfo;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//================== Resume.m ==================</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Resume</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)copyWithZone:(<span class="built_in">NSZone</span> *)zone &#123;</span><br><span class="line">    Resume *resumeCopy = [[[<span class="keyword">self</span> <span class="keyword">class</span>] allocWithZone:zone] init];</span><br><span class="line">    [resumeCopy setName:[_name mutableCopy]];</span><br><span class="line">    [resumeCopy setGender:[_gender mutableCopy]];</span><br><span class="line">    [resumeCopy setAge:[_age mutableCopy]];</span><br><span class="line">    [resumeCopy setUniversityInfo:[_universityInfo <span class="keyword">copy</span>]];</span><br><span class="line">    <span class="keyword">return</span> resumeCopy;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>同样地，简历对象也需要遵从 <strong><em>NSCopying</em></strong> 协议并实现 <code>copyWithZone:</code> 方法。</p>
</blockquote>
<p>最后我们看一下复制的效果有没有达到我们的预期（被复制对象和复制对象的地址和它们所有的属性对象的地址都不相同）。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== Using by client ==================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//resume for LiLei</span></span><br><span class="line">Resume *resume = [[Resume alloc] init];</span><br><span class="line">resume.name = <span class="string">@"LiLei"</span>;</span><br><span class="line">resume.gender = <span class="string">@"male"</span>;</span><br><span class="line">resume.age = <span class="string">@"24"</span>;</span><br><span class="line">    </span><br><span class="line">UniversityInfo *info = [[UniversityInfo alloc] init];</span><br><span class="line">info.universityName = <span class="string">@"X"</span>;</span><br><span class="line">info.startYear = <span class="string">@"2014"</span>;</span><br><span class="line">info.endYear = <span class="string">@"2018"</span>;</span><br><span class="line">info.major = <span class="string">@"CS"</span>;</span><br><span class="line">    </span><br><span class="line">resume.universityInfo = info;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//resume_copy for HanMeiMei</span></span><br><span class="line">Resume *resume_copy = [resume <span class="keyword">copy</span>];</span><br><span class="line">    </span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"\n\n\n======== original resume ======== %@\n\n\n======== copy resume ======== %@"</span>,resume,resume_copy);</span><br><span class="line">    </span><br><span class="line">resume_copy.name = <span class="string">@"HanMeiMei"</span>;</span><br><span class="line">resume_copy.gender = <span class="string">@"female"</span>;</span><br><span class="line">resume_copy.universityInfo.major = <span class="string">@"TeleCommunication"</span>;</span><br><span class="line">    </span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"\n\n\n======== original resume ======== %@\n\n\n======== revised copy resume ======== %@"</span>,resume,resume_copy);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面的代码模拟了这样一个场景：李雷同学写了一份自己的简历，然后韩梅梅复制了一份并修改了姓名、性别和专业这三个和李雷不同的信息。</p>
</blockquote>
<p>这里我们重写了 <strong>Resume</strong> 的 <code>description</code> 方法来看一下所有属性的值及其内存地址，最后来看一下 resume 对象和 resume_copy 对象打印的结果：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================== Output log ==================</span></span><br><span class="line"></span><br><span class="line">======== original resume ======== </span><br><span class="line">resume object address:<span class="number">0x604000247d10</span></span><br><span class="line">name:LiLei | <span class="number">0x10bc0c0b0</span></span><br><span class="line">gender:male | <span class="number">0x10bc0c0d0</span></span><br><span class="line">age:<span class="number">24</span> | <span class="number">0x10bc0c0f0</span></span><br><span class="line">university name:X| <span class="number">0x10bc0c110</span></span><br><span class="line">university start year:<span class="number">2014</span> | <span class="number">0x10bc0c130</span></span><br><span class="line">university end year:<span class="number">2018</span> | <span class="number">0x10bc0c150</span></span><br><span class="line">university major:CS | <span class="number">0x10bc0c170</span></span><br><span class="line"></span><br><span class="line">======== <span class="keyword">copy</span> resume ======== </span><br><span class="line">resume object address:<span class="number">0x604000247da0</span></span><br><span class="line">name:LiLei | <span class="number">0xa000069654c694c5</span></span><br><span class="line">gender:male | <span class="number">0xa000000656c616d4</span></span><br><span class="line">age:<span class="number">24</span> | <span class="number">0xa000000000034322</span></span><br><span class="line">university name:X| <span class="number">0xa000000000000581</span></span><br><span class="line">university start year:<span class="number">2014</span> | <span class="number">0xa000000343130324</span></span><br><span class="line">university end year:<span class="number">2018</span> | <span class="number">0xa000000383130324</span></span><br><span class="line">university major:CS | <span class="number">0xa000000000053432</span></span><br><span class="line"></span><br><span class="line">======== original resume ======== </span><br><span class="line">resume object address:<span class="number">0x604000247d10</span></span><br><span class="line">name:LiLei | <span class="number">0x10bc0c0b0</span></span><br><span class="line">gender:male | <span class="number">0x10bc0c0d0</span></span><br><span class="line">age:<span class="number">24</span> | <span class="number">0x10bc0c0f0</span></span><br><span class="line">university name:X| <span class="number">0x10bc0c110</span></span><br><span class="line">university start year:<span class="number">2014</span> | <span class="number">0x10bc0c130</span></span><br><span class="line">university end year:<span class="number">2018</span> | <span class="number">0x10bc0c150</span></span><br><span class="line">university major:CS | <span class="number">0x10bc0c170</span></span><br><span class="line"></span><br><span class="line">======== revised <span class="keyword">copy</span> resume ======== </span><br><span class="line">resume object address:<span class="number">0x604000247da0</span></span><br><span class="line">name:HanMeiMei | <span class="number">0x10bc0c1b0</span></span><br><span class="line">gender:female | <span class="number">0x10bc0c1d0</span></span><br><span class="line">age:<span class="number">24</span> | <span class="number">0xa000000000034322</span></span><br><span class="line">university name:X| <span class="number">0xa000000000000581</span></span><br><span class="line">university start year:<span class="number">2014</span> | <span class="number">0xa000000343130324</span></span><br><span class="line">university end year:<span class="number">2018</span> | <span class="number">0xa000000383130324</span></span><br><span class="line">university major:TeleCommunication | <span class="number">0x10bc0c1f0</span></span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>上面两个是原 resume 和刚被复制后的 copy resume 的信息，可以看出来无论是这两个对象的地址还是它们的值对应的地址都是不同的，说明成功地实现了深复制；</li>
<li>下面两个是原 resume 和被修改后的 copy_resume 的信息，可以看出来新的 copy_resume 的值发生了变化，而且值所对应的地址还是和原 resume 的不同。</li>
</ul>
</blockquote>
<p>注：还可以用序列化和反序列化的办法来实现深复制，因为与代码设计上不是很复杂，很多语言直接提供了接口，故这里不做介绍。</p>
<h2 id="优点-5"><a href="#优点-5" class="headerlink" title="优点"></a>优点</h2><ul>
<li>可以利用原型模式简化对象的创建过程，尤其是对一些创建过程繁琐，包含对象层级比较多的对象来说，使用原型模式可以节约系统资源，提高对象生成的效率。</li>
<li>可以很方便得通过改变值来生成新的对象：有些对象之间的差别可能只在于某些值的不同；用原型模式可以快速复制出新的对象并手动修改值即可。</li>
</ul>
<h2 id="缺点-5"><a href="#缺点-5" class="headerlink" title="缺点"></a>缺点</h2><p>对象包含的所有对象都需要配备一个克隆的方法，这就使得在对象层级比较多的情况下，代码量会很大，也更加复杂。</p>
<h2 id="iOS-SDK-中的应用-1"><a href="#iOS-SDK-中的应用-1" class="headerlink" title="iOS SDK 中的应用"></a>iOS SDK 中的应用</h2><p>Objective-C中可以使用 <strong><em>NSCopying</em></strong> 协议，配合 <code>copyWithZone:</code> 方法; 或者 <strong><em>NSMutableCopying</em></strong> 协议，配合  <code>copyWithZone:/mutableCopyWithZone:</code> 方法。</p>
</section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#设计模式">
    <span class="tag-code">设计模式</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2018/09/15/面向对象设计模式（一）：六大设计原则/">
        <span class="nav-arrow">← </span>
        
          面向对象设计模式（一）：六大设计原则
        
      </a>
    
    
      <a class="nav-right" href="/2018/09/18/面向对象设计模式（三）：结构型设计模式/">
        
          面向对象设计模式（三）：结构型设计模式
        
        <span class="nav-arrow"> →</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- 打赏 START -->
    
    <!-- 打赏 END -->
    <!-- 二维码 START -->
    
    <!-- 二维码 END -->
    
      <!-- No Comment -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title">Catalog</strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#一、简单工厂（Simple-Factory）"><span class="toc-nav-text">一、简单工厂（Simple Factory）</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#定义"><span class="toc-nav-text">定义</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#适用场景"><span class="toc-nav-text">适用场景</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#成员与类图"><span class="toc-nav-text">成员与类图</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#代码示例"><span class="toc-nav-text">代码示例</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#优点"><span class="toc-nav-text">优点</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#缺点"><span class="toc-nav-text">缺点</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#iOS-SDK-中的应用"><span class="toc-nav-text">iOS SDK 中的应用</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#二、工厂方法（Factory-Method-）"><span class="toc-nav-text">二、工厂方法（Factory Method ）</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#定义-1"><span class="toc-nav-text">定义</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#适用场景-1"><span class="toc-nav-text">适用场景</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#成员与类图-1"><span class="toc-nav-text">成员与类图</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#代码示例-1"><span class="toc-nav-text">代码示例</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#优点-1"><span class="toc-nav-text">优点</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#缺点-1"><span class="toc-nav-text">缺点</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#三、抽象工厂（Abstract-Factory）"><span class="toc-nav-text">三、抽象工厂（Abstract Factory）</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#定义-2"><span class="toc-nav-text">定义</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#适用场景-2"><span class="toc-nav-text">适用场景</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#成员和类图"><span class="toc-nav-text">成员和类图</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#代码示例-2"><span class="toc-nav-text">代码示例</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#优点-2"><span class="toc-nav-text">优点</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#缺点-2"><span class="toc-nav-text">缺点</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#总结"><span class="toc-nav-text">总结</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#四、单例模式（Singleton）"><span class="toc-nav-text">四、单例模式（Singleton）</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#定义-3"><span class="toc-nav-text">定义</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#适用场景-3"><span class="toc-nav-text">适用场景</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#成员与类图-2"><span class="toc-nav-text">成员与类图</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#代码示例-3"><span class="toc-nav-text">代码示例</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#优点-3"><span class="toc-nav-text">优点</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#缺点-3"><span class="toc-nav-text">缺点</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#iOS-SDK-中应用"><span class="toc-nav-text">iOS SDK 中应用</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#五、生成器模式（Builder）"><span class="toc-nav-text">五、生成器模式（Builder）</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#定义-4"><span class="toc-nav-text">定义</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#适用场景-4"><span class="toc-nav-text">适用场景</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#成员与类图-3"><span class="toc-nav-text">成员与类图</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#代码示例-4"><span class="toc-nav-text">代码示例</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#优点-4"><span class="toc-nav-text">优点</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#缺点-4"><span class="toc-nav-text">缺点</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#六、原型模式（Prototype）"><span class="toc-nav-text">六、原型模式（Prototype）</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#定义-5"><span class="toc-nav-text">定义</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#适用场景-5"><span class="toc-nav-text">适用场景</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#成员与类图-4"><span class="toc-nav-text">成员与类图</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#代码示例-5"><span class="toc-nav-text">代码示例</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#优点-5"><span class="toc-nav-text">优点</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#缺点-5"><span class="toc-nav-text">缺点</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#iOS-SDK-中的应用-1"><span class="toc-nav-text">iOS SDK 中的应用</span></a></li></ol></li></ol>
    
  </div>
</aside>
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'http://yoursite.com/2018/09/16/面向对象设计模式（二）：创建型设计模式/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

     // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()
        
        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })

    // qrcode
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });

    // gitment
    var gitmentConfig = "";
    if (gitmentConfig !== 'undefined') {
      var gitment = new Gitment({
        id: "面向对象设计模式（二）：创建型设计模式",
        owner: "",
        repo: "",
        oauth: {
          client_id: "",
          client_secret: ""
        },
        theme: {
          render(state, instance) {
            const container = document.createElement('div')
            container.lang = "en-US"
            container.className = 'gitment-container gitment-root-container'
            container.appendChild(instance.renderHeader(state, instance))
            container.appendChild(instance.renderEditor(state, instance))
            container.appendChild(instance.renderComments(state, instance))
            container.appendChild(instance.renderFooter(state, instance))
            return container;
          }
        }
      })
      gitment.render(document.getElementById('comments'))
    }
  })();
</script>

<script>
  var disqus_shortname = '';
  
  var disqus_url = 'http://yoursite.com/2018/09/16/面向对象设计模式（二）：创建型设计模式/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2018 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    <br>
    Theme by <a href="https://github.com/yanm1ng">yanm1ng</a>
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script src="/js/script.js"></script>
  </body>
</html>